# koishi-plugin-bangumi-sub

## 简介

一个查询新番的 Koishi 插件，提供当季新番查询（以图片形式输出）、订阅及播出提醒功能，并支持自动解析番剧链接。

## 功能列表

- **本季新番查询**: 以图片形式提供今日及本周的新番播出日历。
- **指定日期查询**: 查看指定星期几的新番播出信息。
- **番剧订阅**: 订阅您感兴趣的番剧，将在播出时自动收到推送提醒。
- **订阅管理**: 提供查看、删除、清空及测试订阅的功能。
- **链接解析**: 自动识别 bangumi.tv 链接并显示详细番剧信息。
- **网页截图**: 可选的网页截图功能，展示番剧页面内容。

## 依赖

本插件依赖以下 Koishi 插件或服务：
- `koishi-plugin-puppeteer`: 用于将番剧日历渲染为图片和网页截图功能。
- `database`: 用于存储用户订阅信息。

请确保您的 Koishi 实例已正确安装并配置上述依赖。

## 配置项

| 配置项 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `detailsForToday` | `boolean` | `false` | "今日新番"指令是否番剧输出详细信息（以合并转发的形式）。 |
| `subscriptionInterval`| `number`| `60` | 订阅推送的检查间隔时间（单位：分钟）。|
| `enableWebpageScreenshot` | `boolean` | `false` | 链接解析时是否附带网页截图，默认关闭。|
| `debug` | `boolean` | `false` | 是否在控制台输出详细的调试日志。 |
| `messages` | `object` | 内置默认值 | 回复/推送/解析等消息模板配置，支持 `{placeholder}` 占位符（字段见 `src/index.ts`）。 |

## 指令列表

- `今日新番`: 查询当天播出的所有新番。
- `本周新番`: 查询本周每天播出的新番。
- `查看新番 <1-7>`: 查看指定星期几的新番（1为周一，7为周日）。
- `订阅 <番剧ID>`: 订阅一个新番。番剧 ID 可通过查询指令获得。
- `查看订阅`: 查看当前群组的所有订阅。
- `删除订阅 <序号>`: 删除指定序号的订阅。
- `清空订阅`: 清空当前群组的所有订阅。
- `订阅推送测试`: 立即测试并推送当前群组的所有订阅提醒。

## 自动功能

- **链接识别**: 自动识别消息中的 bangumi.tv 或 bgm.tv 链接
- **信息展示**: 显示番剧标题、评分、排名、简介等详细信息
- **封面图片**: 自动获取并显示番剧封面
- **网页截图**: 可选择性截取番剧页面的关键部分（需开启配置）

## 更新日志

### v0.2.0 (2025-09-24)

**新增功能**
- ✨ 新增 `查看新番 <1-7>` 指令，支持查看指定星期几的新番
- ✨ 自动识别并解析 bangumi.tv/bgm.tv 链接，显示详细番剧信息
- ✨ 新增网页截图功能，可截取番剧页面关键内容（可配置开关）
- ✨ 新增 `enableWebpageScreenshot` 配置项，控制是否启用网页截图

### v0.3.0 (2026-01-07 by：这位同学)

**新增功能**
- ✨ 调整指令结构，所有子指令追加 `新番` 为父指令
- ✨ 调整项目结构，方便分别对每个指令下对应功能进行维护 `index.ts` 仅做分发
- ✨ 在 koishi 的 webui 中追加可配置的返回消息格式

## 鸣谢

- 本插件的番剧数据来源于 [bgmlist.com](https://bgmlist.com) 和 [Bangumi 番组计划](https://bgm.tv)。

## 免责声明

- 本插件仅供学习和交流使用，插件作者不对数据的准确性、服务的稳定性作任何保证。
- 因使用本插件而产生的任何直接或间接的法律责任或损失，插件作者不承担任何责任。

## License

[MIT](https://opensource.org/licenses/MIT) © 2025 [WhiteBr1ck](https://github.com/WhiteBr1ck)
